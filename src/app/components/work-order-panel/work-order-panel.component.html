<!-- Day template for datepicker -->
<ng-template #dayTemplate let-date let-data="data">
  <div 
    class="custom-day"
    [class.selected]="data?.selected"
    [class.disabled]="data?.disabled"
    [class.today]="data?.today"
  >
    {{ date.day }}
  </div>
</ng-template>

@if (isOpen) {
  <div class="panel-backdrop" (click)="onBackdropClick($event)">
    <div class="panel-container" (click)="$event.stopPropagation()">
      <div class="panel-header">
        <div class="panel-title-section">
          <h2 class="panel-title">Work Order Details</h2>
          <p class="panel-subtitle">Specify the dates, name and status for this order</p>
        </div>
        <div class="panel-actions">
          <app-button variant="regular" (clicked)="onCancel()">Cancel</app-button>
          <app-button variant="primary" [disabled]="!form.valid" (clicked)="onSubmit()">
            {{ mode === 'create' ? 'Create' : 'Save' }}
          </app-button>
        </div>
      </div>

      <form [formGroup]="form" class="panel-form">
        @if (errorMessage || validationError) {
          <div class="error-message">
            {{ errorMessage || validationError }}
          </div>
        }

        <div class="form-group">
          <label class="form-label">Work Order Name</label>
          <input
            type="text"
            class="form-input"
            formControlName="name"
            placeholder="Acme Inc."
          />
        </div>

        <div class="form-group">
          <label class="form-label">Status</label>
          <ng-select
            formControlName="status"
            [items]="statusOptions"
            bindLabel="label"
            bindValue="value"
            [clearable]="false"
            [searchable]="false"
            class="status-select"
          >
            <ng-template ng-label-tmp let-item="item">
              <app-status-badge [status]="item.value" [label]="item.label" />
            </ng-template>
            <ng-template ng-option-tmp let-item="item">
              <span class="status-option">{{ item.label }}</span>
            </ng-template>
          </ng-select>
        </div>

        <div class="form-group">
          <label class="form-label">End date</label>
          <div class="date-input-wrapper">
            <input
              class="form-input date-input"
              [value]="formatDisplayDate(form.get('endDate')?.value)"
              readonly
              (click)="showEndDatePicker = !showEndDatePicker"
            />
            <button type="button" class="date-picker-toggle" (click)="showEndDatePicker = !showEndDatePicker">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12.667 2.667H3.333C2.597 2.667 2 3.264 2 4v9.333c0 .737.597 1.334 1.333 1.334h9.334c.736 0 1.333-.597 1.333-1.334V4c0-.736-.597-1.333-1.333-1.333z" stroke="#687196" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10.667 1.333v2.667M5.333 1.333v2.667M2 6.667h12" stroke="#687196" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          @if (showEndDatePicker) {
            <ngb-datepicker
              [startDate]="form.get('endDate')?.value"
              (dateSelect)="onEndDateSelect($event)"
              navigation="select"
              [showWeekNumbers]="false"
              [markDisabled]="markEndDateDisabled"
              [dayTemplate]="dayTemplate"
              [dayTemplateData]="getDayTemplateData('endDate')"
            />
          }
        </div>

        <div class="form-group">
          <label class="form-label">Start date</label>
          <div class="date-input-wrapper">
            <input
              class="form-input date-input"
              [value]="formatDisplayDate(form.get('startDate')?.value)"
              readonly
              (click)="showStartDatePicker = !showStartDatePicker"
            />
            <button type="button" class="date-picker-toggle" (click)="showStartDatePicker = !showStartDatePicker">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M12.667 2.667H3.333C2.597 2.667 2 3.264 2 4v9.333c0 .737.597 1.334 1.333 1.334h9.334c.736 0 1.333-.597 1.333-1.334V4c0-.736-.597-1.333-1.333-1.333z" stroke="#687196" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10.667 1.333v2.667M5.333 1.333v2.667M2 6.667h12" stroke="#687196" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </button>
          </div>
          @if (showStartDatePicker) {
            <ngb-datepicker
              [startDate]="form.get('startDate')?.value"
              (dateSelect)="onStartDateSelect($event)"
              navigation="select"
              [showWeekNumbers]="false"
              [markDisabled]="markStartDateDisabled"
              [dayTemplate]="dayTemplate"
              [dayTemplateData]="getDayTemplateData('startDate')"
            />
          }
        </div>
      </form>
    </div>
  </div>
}
